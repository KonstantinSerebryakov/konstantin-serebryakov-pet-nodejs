var p=Object.defineProperty;var y=(e,t,i)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var r=(e,t,i)=>(y(e,typeof t!="symbol"?t+"":t,i),i);import{a9 as E,aa as C}from"./index.a468aedf.js";import{a as d}from"./axios.b55e1699.js";class c{constructor(t){r(this,"id");r(this,"profileId");r(this,"firstName");r(this,"lastName");r(this,"birthday");this.id=t.id,this.profileId=t.profileId,this.firstName=t.firstName,this.lastName=t.lastName,this.birthday=t.birthday}getPublic(){return{firstName:this.firstName,lastName:this.lastName,birthday:this.birthday}}getFirstName(){const t=this.firstName;return t&&t.length>0?t:"Not Given"}getLastName(){const t=this.lastName;return t&&t.length>0?t:"Not Given"}getBirthdayString(t="."){return this.birthday?this.birthday.getFullYear()+t+(this.birthday.getMonth()+1)+t+this.birthday.getDate():"Not Given"}static getEmpty(){return new c({firstName:"",lastName:"",birthday:null})}}class A{constructor(t){r(this,"id");r(this,"profileId");r(this,"firstName");r(this,"lastName");r(this,"birthday",{day:null,month:null,year:null});this.id=t.id,this.profileId=t.profileId,this.firstName=t.firstName,this.lastName=t.lastName,this.setBirthday(t.birthday)}setBirthday(t){t?this.birthday={day:t.getDate(),month:t.getMonth()+1,year:t.getFullYear()}:this.birthday={day:null,month:null,year:null}}getBirthdayDate(){if(!this.birthday||!this.birthday.day||!this.birthday.month||!this.birthday.year)return null;const t=this.birthday.year.toString().padStart(4,"0"),i=this.birthday.month.toString().padStart(2,"0"),s=this.birthday.day.toString().padStart(2,"0"),a=new Date(`${t}-${i}-${s}T00:00:00Z`);return a.getFullYear()===this.birthday.year&&a.getMonth()===this.birthday.month-1&&a.getDate()===this.birthday.day?a:null}getCredentialEntity(){return new c({id:this.id,profileId:this.profileId,firstName:this.firstName,lastName:this.lastName,birthday:this.getBirthdayDate()})}}class g{constructor(t){r(this,"id");r(this,"iconUrl");r(this,"name");this.id=t.id,this.iconUrl=t.iconUrl,this.name=t.name}getPublic(){return{iconUrl:this.iconUrl,name:this.name}}}class S{constructor(t){r(this,"id");r(this,"profileId");r(this,"socialMediaVariant");r(this,"isActive");r(this,"link");this.id=t.id,this.profileId=t.profileId,this.socialMediaVariant=new g(t.socialMediaVariant),this.isActive=t.isActive,this.link=t.link}getPublicSelf(){return{isActive:this.isActive,link:this.link}}getPublicNested(){return{socialMediaVariant:this.socialMediaVariant.getPublic(),isActive:this.isActive,link:this.link}}}class h{constructor(t){r(this,"id");r(this,"userId");r(this,"socialMediaNodes");r(this,"credential");var i;this.id=t.id,this.userId=t.userId,this.socialMediaNodes=(i=t.socialMediaNodes)==null?void 0:i.map(s=>new S(s)),t.credential&&(this.credential=new c(t.credential))}getPublicSelf(){return{userId:this.userId}}getPublicNested(){var t,i;return{userId:this.userId,socialMediaNodes:(t=this.socialMediaNodes)==null?void 0:t.map(s=>s.getPublicNested()),credential:(i=this.credential)==null?void 0:i.getPublic()}}getCredentialClone(){return this.credential?new c(this.credential):this.credential}getSocialMediaNodesClone(){return this.socialMediaNodes?this.socialMediaNodes.map(t=>new S(t)):this.socialMediaNodes}}const f="profile-store";async function m(e){sessionStorage.setItem(f,JSON.stringify(e))}function N(){const e=sessionStorage.getItem(f);if(!e)return null;const t=JSON.parse(e);if(t.credential&&t.credential.birthday){const i=t.credential.birthday.toString();t.credential.birthday=new Date(i)}return console.log(t),new h(t)}async function P(){sessionStorage.removeItem(f)}class u{static async getProfile(t){const i=`profiles/${t}`,s=await this.fetchApiGet(i),a=new h(s);return n.emit(l.GET_PROFILE_SUCCESS,s),a}static async getProfileDefault(){const t="profiles/default",i=await this.fetchApiGet(t),s=new h(i);return n.emit(l.GET_PROFILE_SUCCESS,s),s}static async updateProfile(t,i){const s=`profiles/profile/${t}/`,a=await this.fetchApiPut(s,i);return n.emit(l.UPLOAD_PROFILE_NESTED_SUCCESS,i),a}static async updateCredential(t,i){const s=`profiles/profile/${t}/credential`,a=await this.fetchApiPut(s,i);return n.emit(l.UPLOAD_CREDENTIAL_SUCCESS,i),a}static async updateSocialMediaNodes(t,i){const s=`profiles/profile/${t}/social-media-nodes`,a=await this.fetchApiPost(s,i);return n.emit(l.UPLOAD_SOCIAL_MEDIA_NODES_SUCCESS,i),a}static async deleteProfile(t){const i=`profiles/profile/${t}`,s=await this.fetchApiDelete(i);return n.emit(l.DELETE_PROFILE_SUCCESS),s}static async fetchApiGet(t){return await d.get(t).then(s=>{if(s.status===200)return s.data.profile;throw new Error(`${s.status}`)})}static async fetchApiPost(t,i){return await d.post(t,i).then(a=>{if(a.status===200||a.status===201)return!0;throw new Error(`${a.status}`)})}static async fetchApiPut(t,i){return await d.put(t,i).then(a=>{if(a.status===200||a.status===201)return!0;throw new Error(`${a.status}`)})}static async fetchApiDelete(t){return await d.delete(t).then(s=>{if(s.status===200||s.status===204)return!0;throw new Error(`${s.status}`)})}}const n=E();var l=(e=>(e.PROFILE_NOT_DEFINED="PROFILE_NOT_DEFINED",e.UPLOAD_PROFILE_NESTED_SUCCESS="UPLOAD_PROFILE_SUCCESS",e.UPLOAD_CREDENTIAL_SUCCESS="UPLOAD_CREDENTIAL_SUCCESS",e.UPLOAD_SOCIAL_MEDIA_NODES_SUCCESS="UPLOAD_SOCIAL_MEDIA_NODES_SUCCESS",e.DELETE_PROFILE_SUCCESS="DELETE_PROFILE_SUCCESS",e.GET_PROFILE_SUCCESS="GET_PROFILE_SUCCESS",e))(l||{});const I=C("profile",{state:()=>({profile:null}),getters:{profileClone:e=>{const t=e.profile;return t?new h(t):null},credentialClone:e=>{const t=e.profile;return t?t.getCredentialClone():null},credentialCloneOrEmpty:e=>{var i;const t=(i=e.profile)==null?void 0:i.getCredentialClone();return t||t||c.getEmpty()},socialMediaNodesClone:e=>{const t=e.profile;return t?t.getSocialMediaNodesClone():null},socialMediaNodesCloneOrEmpty:e=>{const t=e.profile,i=t?t.getSocialMediaNodesClone():null;return i||[]}},actions:{async synchronizeDefault(e=!1){this.$state.profile&&!e||(await this.synchronizeWithSessionStorage(),!this.$state.profile&&await u.getProfileDefault())},async synchronizeById(e,t=!1){this.$state.profile&&!t||(await this.synchronizeWithSessionStorage(),!this.$state.profile&&await u.getProfile(e))},synchronizeWithSessionStorage(){const e=N();if(e){console.log(Object.getOwnPropertyNames(e));const t=new h(e);console.log(t)}e?this.$state.profile=e:this.$state.profile=null},async storeSessionStorage(){const e=this.$state.profile;e?m(e):P()}}}),o=I();n.on("PROFILE_NOT_DEFINED",()=>{o.synchronizeWithSessionStorage()});n.on("UPLOAD_PROFILE_SUCCESS",e=>{const t=e;o.$state.profile=t,o.storeSessionStorage()});n.on("UPLOAD_CREDENTIAL_SUCCESS",e=>{const t=e;o.$state.profile&&(o.$state.profile.credential=t,o.storeSessionStorage())});n.on("UPLOAD_SOCIAL_MEDIA_NODES_SUCCESS",e=>{const t=e;o.$state.profile&&(o.$state.profile.socialMediaNodes=t,o.storeSessionStorage())});n.on("GET_PROFILE_SUCCESS",e=>{const t=e;o.$state.profile=t,o.storeSessionStorage()});n.on("DELETE_PROFILE_SUCCESS",()=>{o.$state.profile=null,o.storeSessionStorage()});export{A as C,u as P,I as u};
